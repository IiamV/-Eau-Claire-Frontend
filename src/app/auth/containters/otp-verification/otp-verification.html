<app-loading
    [message]="'Đang tải'"
    [isShow]="isLoading()"
></app-loading>
<app-auth-layout>
    <div class="px-21 sm:px-5 md:px-0">
        <!-- @if (!isOtpSent()) { -->
        <h2 class="text-5xl font-bold text-center mb-5">
            Quên mật khẩu
        </h2>

        <!-- Form nhập email -->
        <form (ngSubmit)="requestOtp()">
            <div class="">
                <app-primary-forms-input 
                    [formControl]="requestForm" 
                    [id]="'text'" 
                    [label]="'Gửi mã qua '+ (otpPayload.method === 'email' ? 'Email' : 'SMS')" 
                    [type]="'text'"
                    [extraClass]="'bg-[#BD9F69] mt-2 rounded-[13px] w-full  h-12 sm:h-15 pl-4 sm:pl-6 text-white placeholder-[#FFFFFF]/60'"
                    [showIcon]="true"
                    [icon]="otpPayload.method === 'email' 
                    ? 'M2.66667 21.3333C1.93333 21.3333 1.30578 21.0724 0.784 20.5507C0.262222 20.0289 0.000888889 19.4009 0 18.6667V2.66667C0 1.93333 0.261333 1.30578 0.784 0.784C1.30667 0.262222 1.93422 0.000888889 2.66667 0H24C24.7333 0 25.3613 0.261333 25.884 0.784C26.4067 1.30667 26.6676 1.93422 26.6667 2.66667V18.6667C26.6667 19.4 26.4058 20.028 25.884 20.5507C25.3622 21.0733 24.7342 21.3342 24 21.3333H2.66667ZM13.3333 11.7667C13.4444 11.7667 13.5613 11.7498 13.684 11.716C13.8067 11.6822 13.9231 11.6324 14.0333 11.5667L23.4667 5.66667C23.6444 5.55556 23.7778 5.41689 23.8667 5.25067C23.9556 5.08444 24 4.90089 24 4.7C24 4.25556 23.8111 3.92222 23.4333 3.7C23.0556 3.47778 22.6667 3.48889 22.2667 3.73333L13.3333 9.33333L4.4 3.73333C4 3.48889 3.61111 3.48356 3.23333 3.71733C2.85556 3.95111 2.66667 4.27867 2.66667 4.7C2.66667 4.92222 2.71111 5.11689 2.8 5.284C2.88889 5.45111 3.02222 5.57867 3.2 5.66667L12.6333 11.5667C12.7444 11.6333 12.8613 11.6836 12.984 11.7173C13.1067 11.7511 13.2231 11.7676 13.3333 11.7667Z' 
                    : 'M8 12C8.37778 12 8.69467 11.872 8.95067 11.616C9.20667 11.36 9.33422 11.0436 9.33333 10.6667C9.33245 10.2898 9.20444 9.97333 8.94933 9.71733C8.69422 9.46133 8.37778 9.33333 8 9.33333C7.62222 9.33333 7.30578 9.46133 7.05067 9.71733C6.79556 9.97333 6.66756 10.2898 6.66667 10.6667C6.66578 11.0436 6.79378 11.3604 7.05067 11.6173C7.30756 11.8742 7.624 12.0018 8 12ZM13.3333 12C13.7111 12 14.028 11.872 14.284 11.616C14.54 11.36 14.6676 11.0436 14.6667 10.6667C14.6658 10.2898 14.5378 9.97333 14.2827 9.71733C14.0276 9.46133 13.7111 9.33333 13.3333 9.33333C12.9556 9.33333 12.6391 9.46133 12.384 9.71733C12.1289 9.97333 12.0009 10.2898 12 10.6667C11.9991 11.0436 12.1271 11.3604 12.384 11.6173C12.6409 11.8742 12.9573 12.0018 13.3333 12ZM18.6667 12C19.0444 12 19.3613 11.872 19.6173 11.616C19.8733 11.36 20.0009 11.0436 20 10.6667C19.9991 10.2898 19.8711 9.97333 19.616 9.71733C19.3609 9.46133 19.0444 9.33333 18.6667 9.33333C18.2889 9.33333 17.9724 9.46133 17.7173 9.71733C17.4622 9.97333 17.3342 10.2898 17.3333 10.6667C17.3324 11.0436 17.4604 11.3604 17.7173 11.6173C17.9742 11.8742 18.2907 12.0018 18.6667 12ZM0 26.6667V2.66667C0 1.93333 0.261333 1.30578 0.784 0.784C1.30667 0.262222 1.93422 0.000888889 2.66667 0H24C24.7333 0 25.3613 0.261333 25.884 0.784C26.4067 1.30667 26.6676 1.93422 26.6667 2.66667V18.6667C26.6667 19.4 26.4058 20.028 25.884 20.5507C25.3622 21.0733 24.7342 21.3342 24 21.3333H5.33333L0 26.6667ZM4.2 18.6667H24V2.66667H2.66667V20.1667L4.2 18.6667Z'"
                    [placeholder]="otpPayload.method === 'email' ? 'Nhập email' : 'Nhập số điện thoại'">
                </app-primary-forms-input>
            </div>

            @if (!isOtpSent()) {
                <button type="submit"
                    class="w-full h-12 sm:h-15 text-sm sm:text-base text-black border border-[#BD9F69] py-3 rounded-[15px] hover:bg-[#BD9F69]/20 transition-all duration-300 mt-2 mb-6 shadow hover:shadow-lg">
                    Gửi mã xác nhận
                </button>
            }
        </form>
        
        <div>
            @if (isOtpSent()) {
                <div class="flex justify-center gap-4 mt-5 mb-2">
                    <app-otp-input
                        #otpInput
                        [extraInputClass]="'w-10 h-12 sm:w-12 sm:h-14 md:w-14 md:h-16 text-center text-xl sm:text-2xl font-bold border-1 border-[#BD9F69] rounded-[13px] focus:border-[#BD9F69] focus:ring-1 focus:ring-[#BD9F69] outline-none transition'"
                        [extraContainerClass]="'gap-2 sm:gap-3 md:gap-4'"
                        [otpLength]=6
                        [isDisabled]="isOtpTimeout()"
                        (otpComplete)="verifyOtp()"
                        >
                    </app-otp-input>
                </div>

                <div class="text-center text-black mb-3 text-sm sm:text-base">
                    <div class="flex items-center justify-center">
                        <span class=" mr-1">Hết hạn sau:</span>
                        <span class="text-[#A1834F]">{{ formatTime(otpTime()) }}</span>
                    </div>

                    <div>
                        <span class="">Không nhận được mã?</span>
                        <span (click)="requestOtp()" class="text-[#BD9F69] hover:underline font-semibold cursor-pointer">
                            Gửi lại
                        </span>
                    </div>
                </div>

                <div class="justify-center flex mt-4 mb-4 sm:mt-5 sm:mb-5">
                    <app-button
                        (click)="!isOtpTimeout() && verifyOtp()"
                        [buttonText]="'Xác nhận'"
                        [extraClass]="'border-1 border-[#BD9F69] rounded-[15px] w-52 sm:w-72 md:w-96 lg:w-104 h-14 text-base'"
                        >
                    </app-button>
                </div>
            }
        </div>

        <div class="text-center">
            <a [routerLink]="['/forgot-password']"
                class="text-sm sm:text-base text-black hover:underline cursor-pointer inline-flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>

                <span>
                    Quay lại
                </span>
            </a>
        </div>

    </div>
</app-auth-layout>